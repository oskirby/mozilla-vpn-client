{"mappings":"6WAQaA,UAAoBC,EAAAC,yBACfD,EAAAE,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+JCDfC,UAAyBC,EAAAC,gCAE3BC,QACAC,EAAAC,OAAOC,GAAG,WAAYC,GAAMC,KAAKC,kBAAkBF,KACnDC,KAAKE,QAAU,EACfF,KAAKG,SAAW,GAGlBF,kBAAmBG,GACjB,MAAOC,QAACA,EAAOC,SAAEA,GAAaF,EAC9BC,EAAQE,IAAM,IAAIC,IAAIH,EAAQE,KAC9BP,KAAKE,UACLF,KAAKG,SAASM,KAAK,CAAEC,GAAIV,KAAKE,gBAASG,WAASC,IAC5CN,KAAKG,SAASQ,OAdI,IAepBX,KAAKG,SAASS,QAEhBZ,KAAKa,KAAK,CAAEC,KAAM,SAAUC,KAAMf,KAAKG,WAGzCa,IAAKN,GACH,OAAOV,KAAKG,SAASO,GAEvBO,QACEC,QAAQC,IAAI,2BACZvB,EAAAC,OAAOuB,YAAY,kBAIhB,MAAMC,EAAkB,IAAI7B","sources":["views/view-network.js","inspector/NetworkObserver.js"],"sourcesContent":["/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n \nimport { html, css, classMap, LitElement } from 'lit'\n\nimport { NetworkObserver } from '../inspector/NetworkObserver'\n\nexport class ViewNetwork extends LitElement {\n  static styles = css`\n    :host{\n        background:white;\n        display:flex;\n        width:100%;\n        height:100%;\n        overflow-y:auto;\n    }\n    main{\n        height: 100%;\n        max-height: 100%;\n        overflow-y: auto;\n        flex-grow:1;\n    }\n    table{\n        width:100%;\n        padding: 40px;\n        border-spacing: 10px 40px;\n    }\n    aside{\n        height: 100%;\n        max-width:50%;\n        flex-grow:1;\n        display:flex;\n        flex-direction: column;\n        padding:20px;\n        transition: all 0.2s ease;\n        contain: strict;\n        border: solid 5px blue;\n        background: white;\n        color: black;\n\n        position: absolute;\n        width: 50vw;\n   \n        z-index: 20;\n        right: -100vw;\n        height: 90vh;\n        top: 0;\n        bottom: 0;\n        margin: auto;\n        padding: 20px;\n        border-radius: 20px;\n    }\n    aside.active{\n        right: 2vw;\n    }\n    aside section{\n        display: flex;\n        flex-direction: column;\n    }\n    aside > *{\n        margin-top:5px;\n    \n    }\n\n    aside ul{\n        display: flex;\n        flex-direction: row;\n        flex-wrap: wrap;\n        padding: 0;\n        max-width: 30vw;\n        justify-content: space-between;\n    }\n    aside ul >*{\n        flex-grow:1;\n    }\n\n    .requestList{\n        list-style: none;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-content: center;\n        padding: 20px;\n        position: relative;\n    }\n    .requestList li{\n        margin: 2px;\n        transition: all 0.2s;\n        cursor: pointer;\n        border-radius: 30px;\n        display: flex;\n        justify-content: space-between;\n        overflow: hidden;\n    }\n    .requestList li.active{\n        background:blue;\n    }\n    .requestList li.error{\n        background:deeppink;\n    }\n    .requestList li.active *{\n        color:white;\n    }\n    .requestList li span{\n        padding: 10px;\n    }\n    .requestList li .status{\n        flex:1;\n        overflow: hidden;\n    }\n    .requestList li .host{\n        flex:2;\n        flex-shrink: 3;\n        overflow: hidden;\n        flex-grow: 5;\n    }\n    .requestList li .path{\n        flex:4;\n    }\n    .requestList li .initator{\n        flex:3;\n        overflow: hidden;\n    }\n\n    \n    `\n\n  static properties = {\n    filter: { type: String }\n  }\n\n  connectedCallback () {\n    super.connectedCallback()\n    NetworkObserver.onAny(() => { this.onRequest() })\n    NetworkObserver.start();\n  }\n\n  onRequest () {\n    this.requestUpdate()\n  }\n\n  openDetail (event, packet) {\n    event.preventDefault()\n    if (packet == this.detail) {\n      return\n    }\n    this.detail = packet\n    this.requestUpdate()\n  }\n\n  closeDetail () {\n    this.detail = undefined\n    this.requestUpdate()\n  }\n\n  requestRow (packet) {\n    const me = this\n    return html`\n            <li @click=\"${(e) => { me.openDetail(e, packet) }}\" class=\"${(this.detail == packet) ? 'active' : ''} ${packet.response.status != '200' ? 'error' : ''}\">\n                <span class=\"status\"> ${packet.response.status}</span>\n                <span class=\"host\"> ${packet.request.url.host}</span>\n                <span class=\"path\"> ${packet.request.url.pathname}</span>\n                <span class=\"initator\"> ${packet.request.initiator}</span>\n            </li>\n        `\n  }\n\n  renderDetail (p) {\n    let packet = p\n    if (packet == undefined) {\n      packet = {\n        response: {\n          status: '',\n          headers: {\n            'Conent-Type': 'text/plain'\n          },\n          body: ''\n        },\n        request: {\n          url: '',\n          initator: '',\n          headers: []\n        }\n      }\n    }\n    const classes = { active: packet == undefined }\n    const contentType = packet.response.headers['Content-Type']\n\n    return html`\n         <aside class=\"${p == undefined ? '' : 'active'}\">\n             <button @click=\"${() => this.closeDetail()}\">close</button>\n             <hr>\n            <section>\n                <p>Status: ${packet.response.status}</p>\n                <p>URL: ${packet.request.url}</p>\n                <p>From: ${packet.request.initiator}</p>\n            </section>\n            <hr>\n            <section>\n                <p>Request headers:</p>\n                <pre>${packet.request.headers.map(r => r + '\\n')}</pre>\n            </section>\n            <section>\n                <p>Response headers:</p>\n                <pre>${Object.keys(packet.response.headers).map(key => {\n                    return key + ':' + packet.response.headers[key] + '\\n'\n                })}</pre>\n            </section>\n            <section>\n                <p>Body: </p>\n                <a href=\"data:${contentType};base64,${this.utf8_to_b64(packet.response.body)}\" target=\"_blank\">Inspect ↗️</a>\n                ${this.renderBody(contentType, packet.response.body)}\n            </section>\n         </aside>\n        `\n  }\n\n  utf8_to_b64 (str) {\n    return window.btoa(unescape(encodeURIComponent(str)))\n  }\n\n  renderBody (type, body) {\n    return html`\n        <iframe src=\"data:${type};base64,${this.utf8_to_b64(body)}\"></iframe>\n        `\n  }\n\n  render () {\n    let extra = ''\n    // We only keep 50 requests, so if the detail-request was already removed\n    // from the list, render it at the top\n    if (this.detail && !NetworkObserver.requests.includes(this.detail)) {\n      extra = this.requestRow(this.detail)\n    }\n    return html`\n        <main>\n            <ul class=\"requestList\">\n                ${extra}\n                ${NetworkObserver.requests.map((r) => this.requestRow(r))}\n            </ul>\n        </main>\n        ${this.renderDetail(this.detail)}\n    `\n  }\n}\ncustomElements.define('view-network', ViewNetwork)\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\nimport { Client } from './client'\nimport { GenericDispatcher } from './genericdispatcher'\n\nconst MAX_REQUEST_COUNT = 50\nclass _NetworkObserver extends GenericDispatcher {\n  constructor () {\n    super()\n    Client.on('network', (r) => this.onIncomingRequest(r))\n    this.counter = 0\n    this.requests = []\n  }\n\n  onIncomingRequest (networkRequest) {\n    const { request, response } = networkRequest\n    request.url = new URL(request.url)\n    this.counter++\n    this.requests.push({ id: this.counter, request, response })\n    if (this.requests.length > MAX_REQUEST_COUNT) {\n      this.requests.shift()\n    }\n    this.emit({ type: 'update', list: this.requests })\n  }\n\n  get (id) {\n    return this.requests[id]\n  }\n  start() {\n    console.log('Start network Recording');\n    Client.sendCommand('fetch_network');\n  }\n}\n\nexport const NetworkObserver = new _NetworkObserver()\n"],"names":["$f93b2daf7896fc9e$export$e57de79808915858","$aD10K","LitElement","css","$8b5a8d5b46817dcd$var$_NetworkObserver","$vbrOd","GenericDispatcher","super","$cud2N","Client","on","r","this","onIncomingRequest","counter","requests","networkRequest","request","response","url","URL","push","id","length","shift","emit","type","list","get","start","console","log","sendCommand","$8b5a8d5b46817dcd$export$9e4a2c29ef0a7cf7"],"version":3,"file":"view-network.9df5a89a.js.map"}